<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Video Player</title>
    <script src="https://ajax.googleapis.com/ajax/libs/shaka-player/3.2.0/shaka-player.compiled.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/shaka-player/3.2.0/controls.css">
    <style>
        body {
            width: 100%;
            height: 100%;
            font-family: Poppins;
            display: block;
            position: absolute;
            padding: 0px;
            margin: 0px;
            background: #000;
        }
        video {
            width: 100%;
            height: 100%;
            display: inline-block;
            user-select: none;
        }
    </style>
</head>
<body>
    <center>
        <div data-shaka-player-container style="max-width: 40em;">
            <video autoplay data-shaka-player id="video" poster="" style="width: 100%; height: 100%;"></video>
        </div>
    </center>
    
    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const manifestUri = urlParams.get('url');
        const keysParam = urlParams.get('keys');

        // Parse keys
        let drmConfig = {};
        if (keysParam) {
            const keyPairs = keysParam.split(':');
            if (keyPairs.length === 2) {
                drmConfig[keyPairs[0]] = keyPairs[1];
            }
        }

        async function init() {
            const video = document.getElementById('video');
            const ui = video['ui'];
            const controls = ui.getControls();
            const player = controls.getPlayer();

            // Configure DRM with parsed keys
            player.configure({
                drm: {
                    clearKeys: drmConfig
                }
            });

            // Attach player and UI to the window for console access
            window.player = player;
            window.ui = ui;

            // Error handling
            player.addEventListener('error', onPlayerErrorEvent);
            controls.addEventListener('error', onUIErrorEvent);

            // Load the manifest
            try {
                await player.load(manifestUri);
                console.log('The video has now been loaded!');
            } catch (error) {
                onPlayerError(error);
            }
        }

        function onPlayerErrorEvent(errorEvent) {
            onPlayerError(errorEvent.detail);
        }

        function onPlayerError(error) {
            console.error('Error code', error.code, 'object', error);
        }

        function onUIErrorEvent(errorEvent) {
            onPlayerError(errorEvent.detail);
        }

        document.addEventListener('shaka-ui-loaded', init);
        document.addEventListener('shaka-ui-load-failed', () => {
            console.error('Unable to load the UI library!');
        });
    </script>
</body>
</html>
