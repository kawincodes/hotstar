<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stream</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://content.jwplatform.com/libraries/Z79JsmAO.js"></script>

    <style>
        body {
            height: 100%;
            margin: 0;
            background-color: #121212; /* Black background to avoid white screen */
        }

        #jwplayerDiv {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<div id="jwplayerDiv"></div>

<script>
  // Get all 'id' parameters from the URL
  const urlParams = new URLSearchParams(window.location.search);
  const selectedStreamIds = urlParams.getAll('id'); // Returns an array of selected IDs

  console.log("Selected Stream IDs:", selectedStreamIds); // Debugging

  if (selectedStreamIds.length === 0) {
    console.error("No stream IDs provided in the URL.");
    document.body.innerHTML = "<h2>No stream ID provided in the URL. Please check your URL parameters.</h2>"; // Fallback message
    return;
  }

  // Fetch the sports.json file
  fetch('sports.json')
    .then(response => {
      if (!response.ok) {
        throw new Error("Failed to fetch sports.json");
      }
      return response.json();
    })
    .then(data => {
      console.log("Fetched sports.json data:", data); // Debugging

      // Check if the data contains the selected streams
      selectedStreamIds.forEach(streamId => {
        const stream = data.find(item => item.id == streamId);

        if (stream) {
          console.log("Setting up JW Player for stream ID:", streamId); // Debugging

          // Setup JW Player with dynamic data for the selected stream
          jwplayer("jwplayerDiv").setup({
            file: stream.link, // Video file URL from the JSON
            skin: { name: "netflix" },
            title: stream.title, // Title from JSON
            description: stream.description, // Description from JSON
            logo: {
              file: "https://i.postimg.cc/2yNvT7Qk/slazzer-edit-image-1.png",
              link: "https://telegram.me/vaathala1"
            },
            image: stream.logo, // Logo image (thumbnail) from JSON
            drm: {
              clearkey: {
                key: stream.k,
                keyId: stream.kid
              }
            }
          });
        } else {
          console.error("Stream not found for the given ID:", streamId);
        }
      });
    })
    .catch(error => {
      console.error("Error fetching or parsing the sports.json file:", error);
      document.body.innerHTML = "<h2>Error loading stream. Please check the console for details.</h2>"; // Fallback message
    });
</script>

</body>
</html>
