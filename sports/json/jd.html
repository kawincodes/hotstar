<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stream</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://content.jwplatform.com/libraries/Z79JsmAO.js"></script>

    <style>
        body {
            height: 100%;
            margin: 0;
            background-color: #121212; /* Black background to avoid white screen */
        }

        #jwplayerDiv {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<div id="jwplayerDiv"></div>

<script type="text/javascript">
    // Function to get URL parameter by name
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    var id = getUrlParameter('id');
    
    // If the id parameter is missing or invalid, show an error and exit
    if (!id) {
        console.error("No 'id' parameter found in the URL.");
        document.body.innerHTML = "<h2>No stream ID provided in the URL. Please check your URL parameters.</h2>";
        return;
    }

    // Load the sports.json file and get the video data by ID
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
            var data = JSON.parse(xhr.responseText);
            var videoData = data.find(video => video.id === id);

            // If videoData is not found, show an error message
            if (!videoData) {
                console.error("No video found with the ID:", id);
                document.body.innerHTML = "<h2>Stream not found. Please check the ID.</h2>";
                return;
            }

            // Setup JW Player
            jwplayer("jwplayerDiv").setup({
                title: videoData.name,
                description: "VaathalaTV",
                image: videoData.logo,  // Use logo as thumbnail if needed
                aspectratio: '16:9',
                width: '100%',
                mute: false,
                autostart: true,
                file: videoData.link, // Video file URL from the JSON
                key: "cLGMn8T20tGvW+0eXPhq4NNmLB57TrscPjd1IyJF84o=", // Add your key here
                skin: { name: "netflix" },
                logo: {
                    file: "https://i.postimg.cc/2yNvT7Qk/slazzer-edit-image-1.png", 
                    link: "https://telegram.me/vaathala1"
                },
                type: "mpd", // Set type to "mpd" for DASH stream
                drm: {
                    clearkey: {
                        keyId: videoData.kid,
                        key: videoData.k
                    }
                },
                captions: {color: '#ffb800', fontSize: 30, backgroundOpacity: 0},
                sharing: {
                    sites: ['facebook', 'twitter']
                }
            });
        }
    };

    xhr.open('GET', 'sports.json', true);
    xhr.send();
</script>

</body>
</html>
