<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live</title>
    <link rel="stylesheet" href="assets/style.css">
    <style>
        /* Your existing styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 20px;
            position: relative;
        }
        #player {
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            position: relative;
        }
        .video-wrapper {
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            position: relative;
        }
        .video-wrapper iframe {
            width: 100%;
            height: 450px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .info-box {
            /* Your existing styles */
        }
        .chat-container {
            display: none; /* Initially hide chat */
            /* Other styles */
        }
        /* Your existing styles */
    </style>
</head>
<body>
    <div class="container">
        <div id="player"></div>
        <div class="video-wrapper" id="videoWrapper">
            <iframe id="videoIframe" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <div class="info-box">
            <div class="logo">
                <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram Logo">
            </div>
            <div class="info-content">
                <h2>Join Us on Telegram</h2>
                <a href="https://t.me/vaathala1" target="_blank" rel="noopener noreferrer">Join Telegram</a>
            </div>
        </div>
        <div class="chat-container" id="chatBox">
            <button class="chat-close" id="chatClose"></button>
            <iframe src="https://www.youtube.com/live_chat?v=9M02G5c6x6w&embed_domain=vaathala00.github.io" allow="microphone; camera"></iframe>
        </div>
        <button class="chat-toggle" id="chatToggle"></button>
    </div>
    <a class="telegram-link" href="https://t.me/vaathala1" target="_blank" rel="noopener noreferrer">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Join Telegram">
    </a>

    <!-- JW Player scripts -->
    <script src="assets/KB5zFt7A.js"></script>
    <script src="assets/jwpsrv.js" async></script>
    <script src="assets/vast.js" async></script>

    <!-- JW Player license key -->
    <script type="text/javascript">
        jwplayer.key = 'Khpp2dHxlBJHC8MCmLnBuV2jK/DwDnJMniwF6EO9HC/riJ712ZmbHg==';
    </script>

    <script>
        // Function to get URL parameter by name
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Function to initialize the video player
        function initializePlayer(videoData) {
            if (videoData.link && (videoData.link.includes("youtube.com") || 
                videoData.link.includes("vimeo.com") || 
                videoData.link.includes("dailymotion.com"))) {
                // Handle video links
                document.getElementById('player').style.display = 'none';
                const videoIframe = document.getElementById('videoIframe');
                videoIframe.src = videoData.link;
            } else if (videoData.stream_link) {
                // Handle HLS stream
                document.getElementById('videoIframe').style.display = 'none';
                document.getElementById('player').style.display = '';
                const playerInstance = jwplayer("player").setup({
                    title: videoData.name,
                    description: "VaathalaTV",
                    image: videoData.logo,
                    aspectratio: '16:9',
                    width: '100%',
                    mute: false,
                    autostart: true,
                    skin: {
                        name: "netflix"
                    },
                    logo: {
                        file: "https://i.postimg.cc/2yNvT7Qk/slazzer-edit-image-1.png",
                        link: "https://telegram.me/vaathala1"
                    },
                    captions: {
                        color: "#FFF",
                        fontSize: 14,
                        backgroundOpacity: 0,
                        edgeStyle: "raised"
                    },
                    playlist: [{
                        sources: [{
                            file: videoData.stream_link,
                            type: "hls"
                        }]
                    }],
                    sharing: {
                        sites: ['facebook', 'twitter']
                    }
                });
            } else {
                console.error('No valid link found in videoData:', videoData);
            }
        }

        // Fetch and load video data from JSON
        const id = getUrlParameter('id');
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        console.log('Fetched data:', data);
                        const videoData = data.matches.find(video => video.match_id === parseInt(id));
                        if (videoData) {
                            console.log('Found video data:', videoData);
                            initializePlayer(videoData);
                        } else {
                            console.error('Video data not found for ID: ' + id);
                        }
                    } catch (error) {
                        console.error('Error parsing JSON data:', error);
                    }
                } else {
                    console.error('Failed to load video data. Status code: ' + xhr.status);
                }
            }
        };
        xhr.open('GET', 'https://raw.githubusercontent.com/byte-capsule/FanCode-Hls-Fetcher/main/Fancode_hls_m3u8.Json', true);
        xhr.send();

        // Chat toggle functionality
        document.getElementById('chatToggle').addEventListener('click', function() {
            const chatBox = document.getElementById('chatBox');
            const chatToggle = document.getElementById('chatToggle');
            if (chatBox.style.display === 'none' || chatBox.style.display === '') {
                chatBox.style.display = 'block';
                chatToggle.classList.add('open');
            } else {
                chatBox.style.display = 'none';
                chatToggle.classList.remove('open');
            }
        });

        document.getElementById('chatClose').addEventListener('click', function() {
            const chatBox = document.getElementById('chatBox');
            chatBox.style.display = 'none';
            document.getElementById('chatToggle').classList.remove('open');
        });

        // Make the chat toggle button draggable
        const chatToggle = document.getElementById('chatToggle');
        let isDragging = false;
        let offsetX, offsetY;

        chatToggle.addEventListener('mousedown', (e) => {
            isDragging = true;
            offsetX = e.clientX - chatToggle.getBoundingClientRect().left;
            offsetY = e.clientY - chatToggle.getBoundingClientRect().top;
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', () => {
                isDragging = false;
                document.removeEventListener('mousemove', handleMouseMove);
            });
        });

        function handleMouseMove(e) {
            if (isDragging) {
                chatToggle.style.left = `${e.clientX - offsetX}px`;
                chatToggle.style.top = `${e.clientY - offsetY}px`;
            }
        }
    </script>
</body>
</html>
